<!DOCTYPE html>
<html lang="zxx">

<head>
  <meta charset="UTF-8" />
  <meta name="description" content="member_reservation" />
  <meta name="keywords" content="Cake, unica, creative, html" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  <title>Admin | AdOrder</title>

  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700;800;900&display=swap"
    rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800;900&display=swap"
    rel="stylesheet" />

  <!-- Css Styles -->
  <link rel="stylesheet" href="css/bootstrap.min.css" type="text/css" />
  <link rel="stylesheet" href="css/flaticon.css" type="text/css" />
  <link rel="stylesheet" href="css/barfiller.css" type="text/css" />
  <link rel="stylesheet" href="css/magnific-popup.css" type="text/css" />
  <link rel="stylesheet" href="css/font-awesome.min.css" type="text/css" />
  <link rel="stylesheet" href="css/elegant-icons.css" type="text/css" />
  <link rel="stylesheet" href="css/nice-select.css" type="text/css" />
  <link rel="stylesheet" href="css/owl.carousel.min.css" type="text/css" />
  <link rel="stylesheet" href="css/slicknav.min.css" type="text/css" />
  <link rel="stylesheet" href="css/style.css" type="text/css" />
  <link rel="stylesheet" href="css/fontawesome_6.2.0.css" type="text/css" />
  <link rel="stylesheet" href="css/reservation.css" type="text/css" />
  <link rel="stylesheet" href="css/member_page_overview.css" type="text/css" />
  <!-- <link rel="stylesheet" href="css/alice_style.css" type="text/css" /> -->
</head>
<style>
  .nice-select {
    width: 80%;
  }
</style>

<body>
  <!-- Page Preloder -->
  <div id="preloder">
    <div class="loader"></div>
  </div>

  <!-- Offcanvas Menu Begin -->
  <div class="offcanvas-menu-overlay"></div>
  <div class="offcanvas-menu-wrapper">
    <div class="offcanvas__cart">
      <div class="offcanvas__cart__links">
        <a href="#" class="search-switch"><img src="img/icon/search.png" alt="" /></a>
        <a href="#"><img src="img/icon/heart.png" alt="" /></a>
      </div>
      <div class="offcanvas__cart__item">
        <a href="#"><img src="img/icon/cart.png" alt="" /> <span>0</span></a>
        <div class="cart__price">Cart: <span>$0.00</span></div>
      </div>
    </div>
    <div class="offcanvas__logo">
      <a href="./GoodEatTime.html"><img class="GoodEatTimelogo" src="/img/GoodEatTime_smlogo.png" alt="" /></a>
    </div>
    <div id="mobile-menu-wrap"></div>
    <div class="offcanvas__option">
      <ul>
        <li>
          USD <span class="arrow_carrot-down"></span>
          <ul>
            <li>EUR</li>
            <li>USD</li>
          </ul>
        </li>
        <li>
          ENG <span class="arrow_carrot-down"></span>
          <ul>
            <li>Spanish</li>
            <li>ENG</li>
          </ul>
        </li>
        <li>
          <a href="#">Sign in</a> <span class="arrow_carrot-down"></span>
        </li>
      </ul>
    </div>
  </div>
  <!-- Offcanvas Menu End -->

  <!-- Header Section Begin -->
  <header class="header">
    <div class="header__top">
      <div class="container">
        <div class="row">
          <div class="col-lg-12">
            <div class="header__top__inner">
              <div class="header__top__left">
                <ul>
                  <li>
                    <img class="login_icon" src="./img/Login_icon.png" /><a class="login_text" href="#">登入</a>
                  </li>
                </ul>
              </div>
              <div class="header__logo">
                <a href="./GoodEatTime.html"><img class="goodeattime_logo" src="img/GoodEatTime_logoright.png"
                    alt="" /></a>
              </div>
              <div class="header__top__right">
                <div class="header__top__right__links">
                  <a href="" class="search-switch"><img src="img/icon/search.png" alt="" /></a>
                  <a href="#"><img src="img/icon/heart.png" alt="" /></a>
                </div>
                <div class="header__top__right__cart">
                  <a href="#"><img src="img/icon/cart.png" alt="" /> <span>0</span></a>
                  <div class="cart__price">Cart: <span>$0.00</span></div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="canvas__open"><i class="fa fa-bars"></i></div>
      </div>
    </div>
    <div class="container">
      <div class="row">
        <div class="col-lg-12">
          <nav class="header__menu mobile-menu">
            <ul>
              <li class="active"><a href="./GoodEatTime.html">首頁</a></li>
              <li><a href="./about.html">會員專區</a></li>
              <li><a href="./shop.html">餐廳</a></li>
              <li><a href="./blog.html">線上商城</a></li>
              <li>
                <a href="#">關於我們</a>
                <ul class="dropdown">
                  <li><a href="./shop-details.html">Shop Details</a></li>
                  <li><a href="./shoping-cart.html">Shoping Cart</a></li>
                  <li><a href="./checkout.html">Check Out</a></li>
                  <li><a href="./wisslist.html">Wisslist</a></li>
                  <li><a href="./Class.html">Class</a></li>
                  <li><a href="./blog-details.html">Blog Details</a></li>
                </ul>
              </li>
              <li><a href="./contact.html">地點搜尋</a></li>
            </ul>
          </nav>
        </div>
      </div>
    </div>
  </header>
  <!-- Header Section End -->

  <!-- Class Section Begin -->
  <section class="class">
    <!-- <div class="container"> -->
    <div class="row" id="member">
      <!-- <div class="col-lg-2" id="left"> -->
      <div class="col-lg-2" id="left"">
        <nav class=" header__menu mobile-menu" id="aaa">
        <ul>
          <li class=""><a href="">總覽</a></li>
          <li class=""><a href="">使用者管理</a></li>
          <li class=""><a href="">資料審核</a></li>
          <li class=""><a href="">廣告方案設定</a></li>
          <li class=""><a href="">客訴處理</a></li>
          <li class=""><a href="">點數及優惠券設定</a></li>
          <li class=""><a href="">會員分級設定</a></li>
        </ul>
        </nav>
      </div>
      <div class="col-lg-10">
        <div class="row-col-12"
          style="align-items:center; display: grid;justify-content:left;height:10%; margin-top: 20px;margin-left: 20px;">
          <input type="search" class="membership_search" data-table="userNo-table" placeholder="輸入欲查詢之資料"
            style="width: 200px; padding:7px; border-radius: 8px; box-shadow: 5px 5px 2px #FFD382;">
        </div>
        <div class="table-responsive">
          <table class="userNo-table table" width="100%" style="table-layout:fixed;">
            <caption>1. 設定可修改狀態，連動到後端update DB<br>2. 綁定click事件更動編輯紐為確認 -> 管理員僅可修改審核兩欄之資料 <br>3. 左側欄滑鼠移動會跑版QQ<br>4.
              消滅表格第七欄底線</caption>
            <thead align="center">
              <tr>
                <th align="center" style="border:3px #FFD382 dashed; width:90px">訂單No</th>
                <th align="center" style="border:3px #FFD382 dashed; width:90px">餐廳No</th>
                <th align="center" style="border:3px #FFD382 dashed; width:100px">管理員No</th>
                <th align="center" style="border:3px #FFD382 dashed; width:200px">申請日期</th>
                <th align="center" style="border:3px #FFD382 dashed; width:200px">開始時間</th>
                <th align="center" style="border:3px #FFD382 dashed; width:200px">結束時間</th>
                <th align="center" style="border:3px #FFD382 dashed; width:100px">訂單價格</th>
                <th align="center" style="border:3px #FFD382 dashed; width:105px">審核狀態</th>
                <th align="center" style="border:3px #FFD382 dashed; width:200px">審核備註</th>
                <th align="center" style="border:0px  dashed; width:200px"></th>
                <!-- <th align="center" style="border:3px #FFD382 dashed;"></th> -->
              </tr>
            </thead>
            <tbody id="shipData">
              <tr align="center">
                <td>1</td>
                <td>2</td>
                <td>2</td>
                <td>2022-12-01</td>
                <td>2023-01-01</td>
                <td>2024-01-31</td>
                <td>4000</td>
                <td>審核通過</td>
                <td>餐廳為平台vip</td>
                <td>
                  <input type="button" id="edit_btn" class="btn btn-light" value="編輯" onclick="showButtonEvent()"
                    style="width: auto; padding:2px; border-radius: 8px; box-shadow: 3px 3px 1px #FFD382;">
                  <!-- <button type="button" class="btn btn-light" onclick="showButtonEvent()"
                    style="width: auto; padding:2px; border-radius: 8px; box-shadow: 3px 3px 1px #FFD382;">編輯</button> -->
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

    </div>

    <tbody id="reserve">
    </tbody>
    </table>
    </div>

    </div>
    </div>
    </div>
  </section>

  <!-- Class Section End -->

  <!-- Footer Section Begin -->
  <footer class="footer set-bg" data-setbg="img/footer_bg.jpg">
    <!-- <button type="button" id="BackTop"></button> -->
    <div class="mask">
      <div class="container">
        <div class="row">
          <div class="col-lg-3 col-md-3 col-sm-3">
            <div class="footer__member">
              <h6>會員專區</h6>
              <div class="footer__social">
                <a href="#">登入會員<i></i></a>
                <a href="#">訂位管理<i></i></a>
                <br />
                <a href="#">加入會員<i></i></a>
                <a href="#">定位管理<i></i></a>
                <br />
                <a href="#">優惠券<i></i></a>
                <a href="#">我的評論<i></i></a>
              </div>
            </div>
          </div>
          <div class="col-lg-2 col-md-3 col-sm-3">
            <div class="footer__restaurant">
              <h6>餐廳</h6>
              <div class="footer__social">
                <a href="#">訂位<i></i></a>
                <br />
                <a href="#">購物車<i></i></a>
              </div>
            </div>
          </div>
          <div class="col-lg-2 col-md-3 col-sm-3">
            <div class="footer__shopping">
              <h6>線上商城</h6>
              <div class="footer__social">
                <a href="#">商品搜尋<i></i></a>
                <br />
                <a href="#">購物車<i></i></a>
              </div>
            </div>
          </div>
          <div class="col-lg-2 col-md-3 col-sm-3">
            <div class="footer__aboutus">
              <h6>關於我們</h6>
              <div class="footer__social">
                <a href="#">網站介紹<i></i></a>
                <br />
                <a href="#">履歷<i></i></a>
              </div>
            </div>
          </div>
          <div class="col-lg-3 col-md-9 col-sm-12">
            <div class="footer__widget">
              <h6>好食光</h6>
              <ul>
                <li>指導老師：</li>
                <li>吳永志老師 | 吳冠宏老師</li>
                <li>張互賓老師 | 郭惠民老師</li>
                <li>陳怡榕老師 | 馬全德老師</li>
                <li>組員 :</li>
                <li>陳宜瀅 | 張家銘 | 楊婕妤</li>
                <li>游育碩 | 黃郁婕 | 李佳欣 | 余可凡</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="copyright">
      <div class="container">
        <div class="row">
          <div class="col-lg-7">
            <p class="copyright__text text-white">
              <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
              Copyright &copy;
              <script>
                document.write(new Date().getFullYear());
              </script>
              All rights reserved | This template is made with
              <i class="fa fa-heart" aria-hidden="true"></i> by
              <a href="https://colorlib.com" target="_blank">Colorlib</a>
              <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
            </p>
          </div>
          <div class="col-lg-5">
            <div class="copyright__widget">
              <ul>
                <li><a href="#">Privacy Policy</a></li>
                <li><a href="#">Terms & Conditions</a></li>
                <li><a href="#">Site Map</a></li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
  </footer>
  <!-- Footer Section End -->

  <!-- Search Begin -->
  <div class="search-model">
    <div class="h-100 d-flex align-items-center justify-content-center">
      <div class="search-close-switch">+</div>
      <form class="search-model-form">
        <input type="text" id="search-input" placeholder="Search here....." />
      </form>
    </div>
  </div>
  <!-- Search End -->

  <!-- Js Plugins -->
  <script src="js/jquery-3.3.1.min.js"></script>
  <script src="js/bootstrap.min.js"></script>
  <script src="js/jquery.nice-select.min.js"></script>
  <script src="js/jquery.barfiller.js"></script>
  <script src="js/jquery.magnific-popup.min.js"></script>
  <script src="js/jquery.slicknav.js"></script>
  <script src="js/owl.carousel.min.js"></script>
  <script src="js/jquery.nicescroll.min.js"></script>
  <script src="js/main.js"></script>
  <script src="js/alice_admin2_membership_management_page.js"></script>


  <script> // GET
    // const shipData = document.querySelector('#shipData')
    const URL = 'http://localhost:8080/adOrders'
    let resData = [];
    // 抽換資料
    const template = (order_no, rest_no, adminNo, orderTime, startTime, endTime, price, verified, verified_detail) => {
      return `<tr align="center">
                <td id="orderNo${order_no}" >
                  <div class="d-flex justify-content-center">
                    ${order_no}
                  </div>
                  <div class="d-none">
                    <input class="w-100" type="date" name="" id="">
                  </div>
                </td>
                <td>${rest_no}</td>
                <td id="adminNo${order_no}" >
                  <div class="d-flex justify-content-center">
                    ${!!adminNo == 0 ? '-' : adminNo}
                  </div>
                  <div id="dropdownDIV${order_no}" class="dropdown d-flex">
                    <button id="dropdown${order_no}" class="btn btn-secondary btn-sm dropdown-toggle d-none" type="button" data-bs-toggle="dropdown" aria-expanded="false">管理員No</button>
                      <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
                        <li><button class="dropdown-item active" type="button">抓資料</button></li>
                      </ul>
                  </div>
                </td>
                <td>${orderTime}</td>
                <td id="startTime${order_no}" >
                  <div class="d-flex justify-content-center">
                    ${startTime}
                  </div>
                  <div class="d-none">
                    <input class="w-100" type="date" name="" id="startDate${order_no}">
                  </div>
                </td>
                <td id="endTime${order_no}" >
                  <div class="d-flex justify-content-center">
                    ${endTime}
                  </div>
                  <div class="d-none">
                    <input class="w-100" type="date" name="" id="endDate${order_no}" value="" disabled>
                  </div>
                </td>
                <td  id="price${order_no}" >${price}</td>
                <td id="verified${order_no}" >
                  <div class="d-flex justify-content-center">${!!verified ? '審核通過' : '尚未審核'}</div>
                  <div class="d-none">
                    <input class="w-100" type="date" name="" id="" disabled>
                  </div>
                </td>
                <td>${verified_detail === null ? '-' : verified_detail}</td>
                <td >
                  <div class="row">
                    <div class="col-12">
                      <input type="button" id="btnEdit${order_no}" class="btn btn-light edit_btn d-inline-flex" value="編輯" onclick="showButtonEvent()"
                        style="width: auto; padding:2px; border-radius: 8px; box-shadow: 3px 3px 1px #FFD382;">
                    </div>
                    <div class="col-12 d-block">
                      <button id="btnDelete${order_no}" type="button" class="btn btn-light d-none" onclick="deleteOrder()"
                      style="width: auto; padding:2px; border-radius: 8px; box-shadow: 3px 3px 1px #111111;">刪除</button>
                    </div>
                  </div>
                </td>
              </tr>`
    }

    const init = async () => {
      // table
      const shipData = document.querySelector('#shipData')
      // GET
      await fetch(URL).then((r) => r.json()).then((data) => {
        resData = data
        shipData.innerHTML = data.map(({
          adOrderNo,
          restaurantNo,
          adminNo,
          adOrderTime,
          adStartTime,
          adEndTime,
          adOrderPrice,
          verified,
          verificationDetail
        }) => template(adOrderNo,
          restaurantNo,
          adminNo,
          adOrderTime,
          adStartTime,
          adEndTime,
          adOrderPrice,
          verified,
          verificationDetail)).join('')
      });

      // get btn
      const onEdit = document.querySelectorAll('.edit_btn')
      onEdit.forEach((btn, index) => {
        btn.onclick = () => { // 點選編輯按鈕
          let { adOrderNo } = resData[index]
          // 點擊變更-> 編輯(顯示刪除)) or 確認(隱藏刪除))
          let edit_btn = document.querySelector(`#btnEdit${adOrderNo}`)
          edit_btn.value = edit_btn.value === '編輯' ? '確認' : '編輯';
          let delete_btn = document.querySelector(`#btnDelete${adOrderNo}`)
          delete_btn.className = edit_btn.value === '編輯' ? 'btn btn-light d-none' : 'btn btn-light d-flex';
          let dropdowns_btn = document.querySelector(`#dropdown${adOrderNo}`)
          dropdowns_btn.className = edit_btn.value === '編輯' ? 'btn btn-secondary btn-sm dropdown-toggle d-none' : 'btn btn-secondary btn-sm dropdown-toggle d-flex';

          // 判斷是否可進行編輯、刪除
          let verify = document.querySelectorAll(`#verified${adOrderNo} > div`)

          if (verify[0].innerHTML === '尚未審核') {

          } else {
            alert('已審核通過，無法修改訂單')
            edit_btn.value = '編輯';
            delete_btn.className = 'btn btn-light d-none';
          }




        }
      })




    }
    window.onload = init
  </script>
  <script> // PUT
    // 管理員身分 -> 僅能修改審核狀態
    // 參數這邊還沒改可修改管理員編號
    // const URL2 = 'http://localhost:8080/adOrders'; // {adOrderNo}
    const updateData = (endpoint, data) => {
      fetch(`${URL2}/${endpoint}`, {
        method: "PUT",
        body: JSON.stringify(data),
        headers: { 'Content-Type': 'application/json' }
      })
        .then((r) => r.json())
        .then((data) => console.log(data));
    };

    // 綁定事件後送出put method請求，抓到改動的資料傳入參數 -> (orderMo, request body data)
    updateData('2', { /* adminNo:${getAdminNo}, */ verified: true, verificationDetail: '12345678' });

    /* 這邊抓URL路徑中的管理員編號adminNo -> 我在controller中用的註解是 @PathVariable(http://.../5) 而非 @RequestPara (http://....?name=2&id=5....)
      Get the current URL
      const currentUrl = window.location.href;
      Split the URL into an array of path segments
      const urlSegments = currentUrl.split('/');
      Get the value of the @PathVariable parameter
      const pathVariableValue = urlSegments[urlSegments.length - 1];
     */



    // 編輯按鈕綁定事件
    // var content = document.getElementById("edit_btn");
    // function showButtonEvent() {
    //   console.log(this);
    //   if (content.value == '編輯') {
    //     content.value = '確認'
    //   } else {
    //     content.value = '編輯'
    //   }
    // }

  </script>
  <script> // DELETE
    // const URL3= "http://localhost:8080/adOrders"; // {adOrderNo}
    const deleteData = endpoint => {
      fetch(`${URL3}/${endpoint}`, {
        method: 'DELETE'
      })
        .then(response => response.json())
        .then(data => console.log(data));
    };

    deleteData('1');
  </script>
</body>

</html>